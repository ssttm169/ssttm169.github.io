import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r,o as c,c as s,a as o,d as e,e as t,f as n,b as i}from"./app-3ea06b8d.js";const l={},g=e("p",null,"一个web前端撸一个视频通话App，是否能做到？当然可以啊，伊隆·马斯克都上天了，开发一个视频通话App能有多难? 为什么别人能做到，我就做不到？ 灵魂拷问自己千百次之后，下定决心，说干就干。",-1),b=i('<h2 id="前期准备" tabindex="-1"><a class="header-anchor" href="#前期准备" aria-hidden="true">#</a> 前期准备</h2><p><strong>前端技术栈: Flutter</strong><br><br> 前期在技术栈选型方面，徘徊了一段时间，做了多个demo，不是各种各样未知的问题，就是性能上的问题而放弃了 uni-app, react-native, taro, tuari-mobile 这些技术栈，最终选定了 Flutter， Flutter是比较牛X的， 跨平台方面，同时支持 window应用，iOS应用，安卓应用也就只有它了。</p><p><strong>后端技术栈：腾讯云</strong><br><br> 就算我会写Java, C#, PHP，Rust， Node.js, Python后端服务，也然并卵，我一个人的团队，开发一个App， 前端和后端都要做, 要搞得猴年马月啊? 有没有现成的serverless CMS平台? 有，而且很成熟，开箱即用，噔噔噔噔，向你们隆重推荐 strapi， 什么？搞错了?不是这个? 是腾讯云开发，为什么是腾讯云开发?（以后我会慢慢解析）。</p><p><strong>需要两台手机</strong><br><br> 音频视通信嘛，肯定需要两个终端。</p><p><strong>平台说明</strong><br><br> window还是macOS平台，看自己的条件， 各个平台所遇到的问题都各不相同, 本文主要以macOS为主。</p><h2 id="webrtc-选择" tabindex="-1"><a class="header-anchor" href="#webrtc-选择" aria-hidden="true">#</a> WebRTC 选择?</h2><p>选择 WebRTC方面，走了一些弯路，最早选择是的 flutter_webrtc，但发现后端以及管理方面的能力，比如用户管理，流量统计，安全审计等等都是没有的，需要自己开发管理后台，天啊。。。市面上已经很多的很厉害的平台，何不直接拿来用？我应该集中时间和精力去做前端和交互（也就是产品），这也是我选择腾讯云的原因，它是TRTC, 生态完整，技术成熟，站在巨人的肩膀上，让我跑得更快，看得更高，更远。</p><h2 id="trtc-app配置与运行" tabindex="-1"><a class="header-anchor" href="#trtc-app配置与运行" aria-hidden="true">#</a> TRTC App配置与运行</h2>',8),m={href:"https://github.com/tencentyun/TUICallKit.git",target:"_blank",rel:"noopener noreferrer"},d=e("pre",null,[e("code",null,`// clone本地
git clone https://github.com/tencentyun/TUICallKit.git
// 具体的路径是  Flutter/example/
`)],-1),u=e("p",null,"除了RTC服务，TUIKit还使用了即时通信IM PaaS 服务，所以也需要开启和使用腾讯的即时通信IM",-1),f=e("p",null,"下面是项目的具体配置和运行说明。",-1),h=e("br",null,null,-1),k=e("br",null,null,-1),_={href:"https://console.cloud.tencent.com/im",target:"_blank",rel:"noopener noreferrer"},y=e("br",null,null,-1),v=i(`<figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2befc9c6f1204df4b65592eb665833fa~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><figure><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/55b35a78835c4d188e1c23eae65d789a~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>2.拿到 SDKAppID和 secretKey 之后，更改项目配置.</p><div class="language-dart line-numbers-mode" data-ext="dart"><pre class="language-dart"><code><span class="token comment">// flutter/example/lib/debug/generate_test_user_sig.dart</span>
<span class="token keyword">class</span> <span class="token class-name">GenerateTestUserSig</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> int sdkAppId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">//修改这里</span>
    <span class="token keyword">static</span> <span class="token class-name">String</span> secretKey <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&#39;&#39;</span></span><span class="token punctuation">;</span> <span class="token comment">// 修改这里</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.创建IM的用户</p>`,5),w=e("br",null,null,-1),j={href:"https://console.cloud.tencent.com/im/account-management",target:"_blank",rel:"noopener noreferrer"},x=i(`<figure><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6b1e9785ae96495daf30a9f20632d1b6~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><figure><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fc2e15f42df743a5ac84e9c4183baa6e~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>注：也可以在客户端临时注册，但呼叫的时候，需要知道对方的userID。</p><p>4.安装依赖<br></p><pre><code>flutter pub get
</code></pre><p>5.xcode 项目配置<br><br> 使用xcode 直接打 Flutter\\example\\ios\\Runner.xcworkspace， 点击Setting -&gt; Accounts</p><p>setting位置<br><br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7402d07693744bc3a70b9fc4e0c69558~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" loading="lazy"></p><p>点击 + 添加Apple ID<br><br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e3eb254b0ceb4f8f912b855f7958a4f6~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" loading="lazy"></p><p>Runner  -&gt; Signing &amp; Capabilities -&gt; Debug<br><br><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/43989d26f4da400ebc4690ad04e797b5~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" loading="lazy"></p><figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d740a496b29244159983e29308e8f18a~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>team 那里选中你刚才新增的Apple ID的团队。<br><br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b9a53cb7c8de4ad994a740c5714bf2f7~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" loading="lazy"></p><p>6.运行App<br></p><figure><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d8eb28cb89e4d5a8927ce8f77b262f3~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>提示失败<br><br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4194b343b21e484891c51f916f5a62ac~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" loading="lazy"></p><p>需要在iphone设置信任 App，具体 设置 -&gt; VPN与设置管理 -&gt; 开发者App，然后点击信任。<br></p><figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e86086002f5745f4b5ad7ee845245da4~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>最后，重新再运行，成功。</p><p>以下是运行成功之后的截图。</p><table><thead><tr><th>Demo图片</th><th></th></tr></thead><tbody><tr><td><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3c5e80b88fc84cc2ae29951e9808eeb5~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" loading="lazy"></td><td><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0e983e185f65434188c8570320bd8756~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" loading="lazy"></td></tr><tr><td><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/297f066a8d71437e8a4ce3e29ab9f898~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" loading="lazy"></td><td><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1354fa2987ce46d8a6486f962fe348bb~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" loading="lazy"></td></tr></tbody></table><p><strong>腾讯云其他链接</strong><br></p>`,20),T=e("br",null,null,-1),z=e("br",null,null,-1),S={href:"https://cloud.tencent.com/product/trtc",target:"_blank",rel:"noopener noreferrer"},C=e("br",null,null,-1),F=e("br",null,null,-1),I={href:"https://console.cloud.tencent.com/trtc",target:"_blank",rel:"noopener noreferrer"},A=e("br",null,null,-1),R=e("br",null,null,-1),B={href:"https://cloud.tencent.com/document/product/647/71930",target:"_blank",rel:"noopener noreferrer"},D=i(`<h2 id="问题与解决方案" tabindex="-1"><a class="header-anchor" href="#问题与解决方案" aria-hidden="true">#</a> 问题与解决方案</h2><p>在运行成功之前，可能还会遇到其他问题，以下是我收集的一些问题和解决方案，供你参考。</p><p><strong>问题: window平台 flutter run 很慢</strong><br><br> 在window上面跑flutter run , 一直停留在Running Gradle task &#39;assembleDebug&#39;... ,这个需要修改 android\\build.gradle文件，改成阿里的镜像。</p><pre><code>// example\\android\\build.gradle
buildscript {
    // 修改这里
    repositories {
        maven { url &#39;https://maven.aliyun.com/repository/public&#39; } // jcenter
        maven { url &#39;https://maven.aliyun.com/repository/gradle-plugin&#39; } // gradle-plugin
        maven { url &#39;https://maven.aliyun.com/repository/central&#39; } // central
        maven { url &#39;https://maven.aliyun.com/repository/google&#39; } // google
        google()
        mavenCentral()
        maven { url &#39;https://jitpack.io&#39; }
    }
}

allprojects {
    // 修改这里
    repositories {
        maven { url &#39;https://maven.aliyun.com/repository/public&#39; }
        maven { url &#39;https://maven.aliyun.com/repository/gradle-plugin&#39; }
        maven { url &#39;https://maven.aliyun.com/repository/central&#39; }
        maven { url &#39;https://maven.aliyun.com/repository/google&#39; }
        google()
        mavenCentral()
        maven { url &#39;https://jitpack.io&#39; }
    }
}
</code></pre><br><p><strong>问题: window平台的运行提示No implementation found for method xxx on channel</strong><br><br> 解决方案: 据平台解释说 不支持虚拟机运行，需要在真机上运行。<br><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/383c6bff90e0403b9cdd9288f728becd~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" loading="lazy"></p><p><strong>问题: macOS平台 flutter run很慢，一直卡 Running pod install...</strong> <br><br> 解决方案: 需要开启魔法（你懂的），并且复制终端代理命令， 具体操作如下：<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/82b1a8eba0ec4b2da56c909ce14e0869~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" loading="lazy"></p><figure><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/72c351db3bef40fbac4c2e5f68ebb723~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45d8b0910b4a46a794dc293ccc2482e1~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p><strong>问题: macOS提示Framework not found TXFFmpeg/TXSoundTouch</strong><br><br> 好不容易,运行不卡，也不慢，，但提示 Framework not found TXFFmpeg 的错误。运行Ruuner，点击Build Phases --&gt; Link Binary.. 搜索 TXFFmpeg 或者 TXSoundTouch 添加上去就可以，然后重新跑Flutter run.</p><p><strong>问题: macOS提示CFBundleShortVersionString的问题</strong> <br><br> 在macOS平台运行时提示 The application&#39;s Info.plist does not contain a valid CFBundleShortVersionString<br><br> 解决方案: xcode打开 Flutter\\example\\ios\\Runner.xcworkspace 在Runnder dashboard 在Build Settings 点击 + 新建添加一个键为 <strong>Marketing Version</strong> 然后搜索 Marketing Version, 在搜索结果 双击编辑 输入 \${FLUTTER_BUILD_NAME} 即可</p><figure><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/84703a0459254597b48877ce0f041345~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><figure><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/59e4452e07ca4adca0543186f2b5340e~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p><strong>问题: App iphone真机上闪退问题</strong><br><br> 排除万能，项目终于可以在iphone真机上面运行了，但把数据线拔了之后，App就闪退了，这是致命的Bug?<br> 原来之前跑的都是debug版本，需要插入数据线链上xcode的。<br><br> 解决方案：设置 Flutter 模块的编译模式为 profile 或 releas， xcode打开 Flutter\\example\\ios\\Runner.xcworkspace， 在Build Settings选项，找到 User-Defined，点击 + 新建，添加一个键为 FLUTTER_BUILD_MODE ，值为 release。</p><figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ad0f63bb0df48c3b01a7e20618482b7~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p><strong>问题: codesign想要访问您的钥匙串中的密钥access</strong><br><br> macOS 真机运行的时候, 弹窗提示 codesign想要访问您的钥匙串中的密钥access, 这是要输入你的Mac开机密码，如不小心点了拒绝。<br> 解决方案： 打开 钥匙串App， 找到登录 -&gt; 我的证书， 把 iPhone DeveloperXXX删除，然后重启xcode， 重新运行项目，再弹窗提示codesign，输入开机密码 点击 始终运行即可。</p><figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c2dabf546b4d4822b01cb82e425e8f33~tplv-k3u1fbpfcp-watermark.image?" alt="2a0affe902a29490719526ef5cfc753.png" tabindex="0" loading="lazy"><figcaption>2a0affe902a29490719526ef5cfc753.png</figcaption></figure><figure><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b408f2b53204189abb003f66af3ebb5~tplv-k3u1fbpfcp-watermark.image?" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h2 id="待处理问题" tabindex="-1"><a class="header-anchor" href="#待处理问题" aria-hidden="true">#</a> 待处理问题</h2><ul class="task-list-container"><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-0" disabled="disabled"><label class="task-list-item-label" for="task-item-0"> 用户注册与登录</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-1" disabled="disabled"><label class="task-list-item-label" for="task-item-1"> 微信登录</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-2" disabled="disabled"><label class="task-list-item-label" for="task-item-2"> 离线呼醒功能</label></li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-3" disabled="disabled"><label class="task-list-item-label" for="task-item-3"> 新功能增加</label></li></ul><h2 id="其他相关链接" tabindex="-1"><a class="header-anchor" href="#其他相关链接" aria-hidden="true">#</a> 其他相关链接</h2>`,21),U={href:"https://www.jianshu.com/p/e1bb7bd80083",target:"_blank",rel:"noopener noreferrer"},M=e("br",null,null,-1),V=e("br",null,null,-1),K={href:"https://blog.csdn.net/crasowas/article/details/127537248",target:"_blank",rel:"noopener noreferrer"},N=e("br",null,null,-1),O=e("br",null,null,-1),X={href:"https://blog.csdn.net/weixin_27437725/article/details/112273583",target:"_blank",rel:"noopener noreferrer"},E=e("br",null,null,-1),L=e("br",null,null,-1),P={href:"https://www.bilibili.com/read/cv2899754/",target:"_blank",rel:"noopener noreferrer"};function G(W,H){const a=r("ExternalLinkIcon");return c(),s("div",null,[g,o(" more "),b,e("p",null,[t("这里我使用带有UI的RTC项目, TuiCallKit项目链接 "),e("a",m,[t("https://github.com/tencentyun/TUICallKit.git"),n(a)])]),d,u,f,e("p",null,[t("1.即时通信IM控制台 新建一个应用"),h,k,t(" 即时通信IM控制台 "),e("a",_,[t("https://console.cloud.tencent.com/im"),n(a)]),y]),v,e("p",null,[t("即时通信 -> 账号管理"),w,e("a",j,[t("https://console.cloud.tencent.com/im/account-management"),n(a)])]),x,e("p",null,[t("实时音视频（Tencent RTC）"),T,z,e("a",S,[t("https://cloud.tencent.com/product/trtc"),n(a)])]),e("p",null,[t("实时音视频控制台"),C,F,e("a",I,[t("https://console.cloud.tencent.com/trtc"),n(a)])]),e("p",null,[t("TuiCallKit 开发文档"),A,R,e("a",B,[t("https://cloud.tencent.com/document/product/647/71930"),n(a)])]),D,e("p",null,[e("a",U,[t("https://www.jianshu.com/p/e1bb7bd80083"),n(a)]),M,V,e("a",K,[t("https://blog.csdn.net/crasowas/article/details/127537248"),n(a)]),N,O,e("a",X,[t("https://blog.csdn.net/weixin_27437725/article/details/112273583"),n(a)]),E,L,e("a",P,[t("https://www.bilibili.com/read/cv2899754/"),n(a)])])])}const q=p(l,[["render",G],["__file","develop-a-video-chat-app-by-using-flutter.html.vue"]]);export{q as default};
