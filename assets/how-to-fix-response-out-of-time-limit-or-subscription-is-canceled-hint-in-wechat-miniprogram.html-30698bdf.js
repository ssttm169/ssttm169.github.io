import{_ as a}from"./plugin-vue_export-helper-c27b6911.js";import{r as s,o as c,c as r,a as l,d as e,e as n,f as t,b as d}from"./app-3ea06b8d.js";const p={},o=e("p",null,'微信小程序 调云函数 信息推送失 败 errcode":45015,"errmsg":"response out of time limit or subscription is canceled hint的具体解决方法',-1),u=e("p",null,[n("查了很多资料都说是， 由于长时间用户OpenId未和微信公众号做互动消息，微信公众号会停止对用户进行消息推送，但没说如何操作，决定写一下详细的操作步骤，希望对你有帮助。"),e("br"),e("br")],-1),m=e("h2",{id:"_1-登录微信公众平台",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#_1-登录微信公众平台","aria-hidden":"true"},"#"),n(" 1.登录微信公众平台")],-1),b={href:"https://mp.weixin.qq.com/%EF%BC%8C",target:"_blank",rel:"noopener noreferrer"},f=e("br",null,null,-1),g=e("br",null,null,-1),h=d(`<h2 id="_2-开启客服收发信息" tabindex="-1"><a class="header-anchor" href="#_2-开启客服收发信息" aria-hidden="true">#</a> 2.开启客服收发信息</h2><p>具体操作是 左边菜单 找到 功能 &gt; 客服，进入后， 开启收发信息 和 增加客服的微信帐号。</p><figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/14387177bd944ddb9996220e28d611f1~tplv-k3u1fbpfcp-watermark.image?" alt="1.png" tabindex="0" loading="lazy"><figcaption>1.png</figcaption></figure><p>绑定客服微信帐号<br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bcd525c5207b4fad9ee1391ab1c63150~tplv-k3u1fbpfcp-watermark.image?" alt="2.png" loading="lazy"></p><p>绑定成功之后，会收到微信公众平台的绑定信息。<br><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/92e6496536114602980241d7efdea4d6~tplv-k3u1fbpfcp-watermark.image?" alt="3.png" loading="lazy"></p><h2 id="_3-给微信小程序客服发信息" tabindex="-1"><a class="header-anchor" href="#_3-给微信小程序客服发信息" aria-hidden="true">#</a> 3.给微信小程序客服发信息</h2><p>先进入自己的微信小程序，查看属性<br><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9dcf6fba23f14fcdafd2eb15ceedc99d~tplv-k3u1fbpfcp-watermark.image?" alt="4.png" loading="lazy"></p><p>在微信小程序的介绍页面，有一个客服的入口，点击进去<br><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/631c1d63aa9e4cb88fb0a403a6bc191f~tplv-k3u1fbpfcp-watermark.image?" alt="5.png" loading="lazy"></p><p>这是关键点， 就是进入客服聊天界面之后，给它发一个信息。<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/292123d20ab14340ad7cc1659ffea796~tplv-k3u1fbpfcp-watermark.image?" alt="6.png" loading="lazy"></p><p>如果你之前已经配置好云函数和推送配置了，这时你可以调云函数进行信息推送了，否则请继续。<br><br></p><h2 id="_4-配置云函数的代码" tabindex="-1"><a class="header-anchor" href="#_4-配置云函数的代码" aria-hidden="true">#</a> 4.配置云函数的代码</h2><p>在 uniapp 的文件夹cloudfunctions 新建一个pushMessage函数（名称命名看你的习惯）。<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f04c89a4542848e899f2ed3b1ea2abe4~tplv-k3u1fbpfcp-watermark.image?" alt="7.png" loading="lazy"></p><p>主要代码下：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>const cloud = require(&#39;wx-server-sdk&#39;)
cloud.init({
  env: cloud.DYNAMIC_CURRENT_ENV
});
 
// 云函数入口函数
exports.main = async (event, context) =&gt; {
    const wxContext = cloud.getWXContext()
    await cloud.openapi.customerServiceMessage.send({
        touser: wxContext.OPENID,
        msgtype: &#39;text&#39;,
        text: {
            content: event.content
        },
    })
    return &#39;success&#39;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>把函数上传到云端<br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bdae527789724701893911ed6745ffc0~tplv-k3u1fbpfcp-watermark.image?" alt="8.png" loading="lazy"></p><h2 id="_5-配置信息推送" tabindex="-1"><a class="header-anchor" href="#_5-配置信息推送" aria-hidden="true">#</a> 5.配置信息推送</h2><p>打开微信开发者工具的云开发，设置 &gt; 其他设置，点击添加信息推送<br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3dd85686b51e43378b6782cbe62ffbb0~tplv-k3u1fbpfcp-watermark.image?" alt="9.png" loading="lazy"></p><p>信息类型选择 text, 云函数选择刚才上传的pushMessage的方法。<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1e995402ee5741569a21b27088bf5d28~tplv-k3u1fbpfcp-watermark.image?" alt="10.png" loading="lazy"></p><h2 id="_6-完成" tabindex="-1"><a class="header-anchor" href="#_6-完成" aria-hidden="true">#</a> 6.完成</h2><p>页面执行调用云函数试一下。</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>wx.cloud.callFunction({
  name: &quot;pushMessage&quot;,
  data: {
    content: &#39;收到了吗?&#39;
  },
}).then((res) =&gt; {
  console.log(&quot;pushMessage.res&quot;, res);
})
.catch((err) =&gt; {
  console.log(&quot;pushMessage.err&quot;, err);
});
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>过一会会（2秒左右），微信收到信息了。<br><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b232524d846e4efebb211c980ef4cc7b~tplv-k3u1fbpfcp-watermark.image?" alt="11.png" loading="lazy"></p><figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8e905ee0f54944fa9cbdb4ff5c882397~tplv-k3u1fbpfcp-watermark.image?" alt="12.png" tabindex="0" loading="lazy"><figcaption>12.png</figcaption></figure>`,23),v=e("br",null,null,-1),_={href:"https://github.com/ssttm169/wechat_push_message",target:"_blank",rel:"noopener noreferrer"},k=e("br",null,null,-1),x=e("br",null,null,-1);function y(j,w){const i=s("ExternalLinkIcon");return c(),r("div",null,[o,l(" more "),u,m,e("p",null,[n("打开， "),e("a",b,[n("https://mp.weixin.qq.com/，"),t(i)]),n(" 扫描登录"),f,g]),h,e("p",null,[n("完整代码在这里"),v,e("a",_,[n("https://github.com/ssttm169/wechat_push_message"),t(i)]),k,x])])}const C=a(p,[["render",y],["__file","how-to-fix-response-out-of-time-limit-or-subscription-is-canceled-hint-in-wechat-miniprogram.html.vue"]]);export{C as default};
