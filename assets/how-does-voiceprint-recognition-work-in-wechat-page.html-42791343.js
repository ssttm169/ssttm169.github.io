import{_ as s}from"./plugin-vue_export-helper-c27b6911.js";import{o as a,c as t,a as p,e as o,d as n,b as e}from"./app-3ea06b8d.js";const c="/posts/voiceprint-recognition/flow.png",i="/posts/voiceprint-recognition/reg-vpr.gif",l="/posts/voiceprint-recognition/login-vpr.gif",u="/posts/voiceprint-recognition/upload-result.png",r={},k=n("p",null,"最近做一个微信的口令红包的功能，准备都要投入使用了， 老板突然发愁，他说 现在的羊毛党这么猖狂，一不小心，10万的推广红包，会不会两天就挨刷完了? ....那我们能否做一个功能校验一下是否同一个人来领取红包，不就得了吗? 他一拍脑袋，接着说，Tom 你给我们做一个声纹识别吧!",-1),d=n("br",null,null,-1),v=e('<br><p>具体的流程如下：<br><img src="'+c+'" alt="具体流程" loading="lazy"></p><br><p>声纹注册用户(最终效果图)∑<br><img src="'+i+'" alt="注册效果图" loading="lazy"></p><br><p>声纹登录(最终效果图)</p><figure><img src="'+l+'" alt="登陆效果图" tabindex="0" loading="lazy"><figcaption>登陆效果图</figcaption></figure><br><p>上传文件识别：<br><img src="'+u+`" alt="上传文件识别" loading="lazy"></p><br><h3 id="服务端" tabindex="-1"><a class="header-anchor" href="#服务端" aria-hidden="true">#</a> 服务端</h3><p>因为声纹识别服务商 不能直接使用客户端直接调用 和 音频不支持的问题，要开发自己的服务端来对接。</p><p>技术栈 koa + co-wecaht-api + mysql + ffmpeg + pm2 + knex</p><p>注：因服务商不支持微信amr文件， 要用ffmpeg 把微信的音频amr文件转码成wav。</p><p>以下是一些相关的代码，，开撸。。</p><p>微信jssdk开发 如果你微信API这一块已经很熟悉了，跳到下一节<br><br><br></p><p>获取微信token</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> api <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">WechatAPI</span><span class="token punctuation">(</span>
	config<span class="token punctuation">.</span>appid<span class="token punctuation">,</span>
	config<span class="token punctuation">.</span>appsecret<span class="token punctuation">,</span>
	<span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token comment">// 传入一个获取全局token的方法</span>
		<span class="token keyword">var</span> txt <span class="token operator">=</span> <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&quot;./token/access_token.txt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token keyword">async</span> <span class="token parameter">token</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token comment">// 请将token存储到全局，跨进程、跨机器级别的全局，比如写到数据库、redis等</span>
		<span class="token comment">// 这样才能在cluster模式及多机情况下使用，以下为写入到文件的示例</span>
		<span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">&quot;./token/access_token.txt&quot;</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注：如果报读取不了token文件，就手动在相应的目录，新建的文本文件, 比如 access_token.txt</p><p><br><br></p><p>获取微信签名</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> jsapi_ticket <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">getLatestTicket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> nonce_str <span class="token operator">=</span> <span class="token string">&#39;abcdefg&#39;</span><span class="token punctuation">;</span>    <span class="token comment">// 密钥，字符串任意，可以随机生成</span>
<span class="token keyword">let</span> timestamp <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>  <span class="token comment">// 时间戳</span>
<span class="token keyword">let</span> url <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">.</span>url<span class="token punctuation">;</span>   <span class="token comment">// 使用接口的url链接，不包含#后的内容</span>
<span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&#39;jsapi_ticket=&#39;</span> <span class="token operator">+</span> jsapi_ticket<span class="token punctuation">.</span>ticket <span class="token operator">+</span> <span class="token string">&#39;&amp;noncestr=&#39;</span> <span class="token operator">+</span> nonce_str <span class="token operator">+</span> <span class="token string">&#39;&amp;timestamp=&#39;</span> <span class="token operator">+</span> timestamp <span class="token operator">+</span> <span class="token string">&#39;&amp;url=&#39;</span> <span class="token operator">+</span> url<span class="token punctuation">;</span>
<span class="token keyword">let</span> signature <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>

ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">appId</span><span class="token operator">:</span> config<span class="token punctuation">.</span>appid<span class="token punctuation">,</span>
    <span class="token literal-property property">timestamp</span><span class="token operator">:</span> timestamp<span class="token punctuation">,</span>
    <span class="token literal-property property">nonceStr</span><span class="token operator">:</span> nonce_str<span class="token punctuation">,</span>
    <span class="token literal-property property">signature</span><span class="token operator">:</span> signature
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><p>跨域请求</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-cors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
	<span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token literal-property property">origin</span><span class="token operator">:</span> <span class="token string">&quot;http://www.xxxx.com&quot;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">maxAge</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
		<span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token literal-property property">allowMethods</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;OPTIONS&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DELETE&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token literal-property property">allowHeaders</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;Content-Type&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Accept&#39;</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><p>ffmpeg转码</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> ffmpeg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fluent-ffmpeg&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token keyword">var</span> command <span class="token operator">=</span> <span class="token function">ffmpeg</span><span class="token punctuation">(</span>_delPath<span class="token punctuation">.</span>amr<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">audioBitrate</span><span class="token punctuation">(</span><span class="token string">&#39;16k&#39;</span><span class="token punctuation">)</span>  <span class="token comment">//16k音频采样率</span>
<span class="token punctuation">.</span><span class="token function">audioFrequency</span><span class="token punctuation">(</span><span class="token number">16000</span><span class="token punctuation">)</span>  <span class="token comment">//16比特音频信号</span>
<span class="token punctuation">.</span><span class="token function">audioQuality</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>   <span class="token comment">//音频质量</span>
<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;end&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;file has been converted succesfully&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;an error happened: &#39;</span> <span class="token operator">+</span> err<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>_delPath<span class="token punctuation">.</span>fix<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><p>提交声纹服务器</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> rp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;request-promise&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">var</span> vprData <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;http://www.xxxx.com&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;cache-control&quot;</span><span class="token operator">:</span> <span class="token string">&quot;no-cache&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;x-udid&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxxxxx&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;x-session-key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxxx&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;x-task-config&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxxxxx&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;x-request-date&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxxxxx&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;x-sdk-version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;5.1&quot;</span><span class="token punctuation">,</span>
        <span class="token string-property property">&quot;x-app-key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;xxxxxxx&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">formData</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// Like &lt;input type=&quot;file&quot; name=&quot;file&quot;&gt;</span>
        <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">value</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span>soundData<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">filename</span><span class="token operator">:</span> soundData<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
                <span class="token literal-property property">contentType</span><span class="token operator">:</span> soundData<span class="token punctuation">.</span>type <span class="token comment">//mp3 = audio/mpeg, wav = audio/wav</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> xml <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">rp</span><span class="token punctuation">(</span>vprData<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//xml to json</span>
<span class="token keyword">var</span> resJson <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> parseString <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;xml2js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parseString<span class="token punctuation">;</span>
<span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">parseString</span><span class="token punctuation">(</span>xml<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        resJson <span class="token operator">=</span> result<span class="token punctuation">.</span>ResponseInfo<span class="token punctuation">;</span>
       	<span class="token comment">//do something</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><h3 id="客户端" tabindex="-1"><a class="header-anchor" href="#客户端" aria-hidden="true">#</a> 客户端</h3><p>技术栈 vue + vue-router + axios。</p><p>去掉微信 长按 弹出复制的按钮</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	document<span class="token punctuation">.</span><span class="token function-variable function">oncontextmenu</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">//初始化 微信jssdk</span>
	vm<span class="token punctuation">.</span><span class="token function">wx_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><p>获取微信签名，注册事件</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>wx<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	<span class="token literal-property property">debug</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。</span>
	<span class="token literal-property property">appId</span><span class="token operator">:</span> res<span class="token punctuation">.</span>appId<span class="token punctuation">,</span> <span class="token comment">// 必填，公众号的唯一标识</span>
	<span class="token literal-property property">timestamp</span><span class="token operator">:</span> res<span class="token punctuation">.</span>timestamp<span class="token punctuation">,</span> <span class="token comment">// 必填，生成签名的时间戳</span>
	<span class="token literal-property property">nonceStr</span><span class="token operator">:</span> res<span class="token punctuation">.</span>nonceStr<span class="token punctuation">,</span> <span class="token comment">// 必填，生成签名的随机串</span>
	<span class="token literal-property property">signature</span><span class="token operator">:</span> res<span class="token punctuation">.</span>signature<span class="token punctuation">,</span> <span class="token comment">// 必填，签名，见附录1</span>
	<span class="token literal-property property">jsApiList</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">&quot;onMenuShareTimeline&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;onMenuShareAppMessage&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;uploadVoice&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;startRecord&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;playVoice&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;stopRecord&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;onVoicePlayEnd&quot;</span>
	<span class="token punctuation">]</span> <span class="token comment">// 必填，需要使用的JS接口列表，所有JS接口列表见附录2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><br><p>提前提示用户授权录音功能， 为了避免 正式开始录音时，同时提示授权，此时录音功能状态已经失控。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>localStorage<span class="token punctuation">.</span>rainAllowRecord <span class="token operator">||</span> localStorage<span class="token punctuation">.</span>rainAllowRecord <span class="token operator">!==</span> <span class="token string">&quot;true&quot;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
	wx<span class="token punctuation">.</span><span class="token function">startRecord</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			localStorage<span class="token punctuation">.</span>rainAllowRecord <span class="token operator">=</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">;</span>
			wx<span class="token punctuation">.</span><span class="token function">stopRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function-variable function">cancel</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;用户拒绝授权录音&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>好了， talk is cheap, show you the code.</p><br><div class="github-widget" data-repo="ssttm169/tom-vpr"></div>`,45);function m(b,g){return a(),t("div",null,[k,p(" more "),d,o(" 说干就干，在寻找 声纹识别服务商，发现什么科大讯飞，还什么BAT等许多大厂都没有支持Web端的，后来找到一个不知名的小厂。。 "),v])}const q=s(r,[["render",m],["__file","how-does-voiceprint-recognition-work-in-wechat-page.html.vue"]]);export{q as default};
